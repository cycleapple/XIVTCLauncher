<Window x:Class="FFXIVSimpleLauncher.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="設定"
        Height="750" Width="520"
        MinHeight="650" MinWidth="400"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        Background="{DynamicResource MaterialDesignPaper}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        FontFamily="{materialDesign:MaterialDesignFont}">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- Row 0: Title -->
            <RowDefinition Height="Auto"/>  <!-- Row 1: First Run Card -->
            <RowDefinition Height="Auto"/>  <!-- Row 2: Game Path -->
            <RowDefinition Height="Auto"/>  <!-- Row 3: Dalamud Title -->
            <RowDefinition Height="Auto"/>  <!-- Row 4: Dalamud Settings -->
            <RowDefinition Height="*"/>     <!-- Row 5: Spacer -->
            <RowDefinition Height="Auto"/>  <!-- Row 6: Buttons -->
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0"
                   x:Name="TitleText"
                   Text="設定"
                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                   Margin="0,0,0,8"/>

        <!-- First Run Welcome Message -->
        <materialDesign:Card Grid.Row="1"
                             x:Name="FirstRunCard"
                             Visibility="Collapsed"
                             Padding="16"
                             Margin="0,0,0,16"
                             Background="{DynamicResource PrimaryHueMidBrush}">
            <StackPanel>
                <TextBlock Text="歡迎使用 XIV TC Launcher！"
                           FontWeight="Bold"
                           FontSize="14"
                           Foreground="White"/>
                <TextBlock Text="請先設定遊戲安裝路徑，這是啟動器運作的必要設定。"
                           TextWrapping="Wrap"
                           Margin="0,4,0,0"
                           Foreground="White"
                           Opacity="0.9"/>
            </StackPanel>
        </materialDesign:Card>

        <!-- Game Path -->
        <StackPanel Grid.Row="2">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0"
                         x:Name="GamePathTextBox"
                         materialDesign:HintAssist.Hint="遊戲路徑"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                         Margin="0,0,8,0"/>

                <Button Grid.Column="1"
                        Content="自動偵測"
                        Click="AutoDetectButton_Click"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Margin="0,0,8,0"/>

                <Button Grid.Column="2"
                        Content="瀏覽"
                        Click="BrowseButton_Click"
                        Style="{StaticResource MaterialDesignOutlinedButton}"/>
            </Grid>
            <TextBlock Text="例如：E:\Program Files\USERJOY GAMES\FINAL FANTASY XIV TC"
                       FontSize="11"
                       Foreground="Gray"
                       Margin="0,4,0,0"/>

            <TextBlock Text="OTP 設定已移至「帳號管理」，請在主視窗點擊帳號旁的齒輪按鈕。"
                       FontSize="11"
                       Foreground="Orange"
                       TextWrapping="Wrap"
                       Margin="0,8,0,0"/>
        </StackPanel>

        <!-- Dalamud Section -->
        <TextBlock Grid.Row="3"
                   Text="Dalamud (插件系統)"
                   Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                   Margin="0,24,0,8"/>

        <StackPanel Grid.Row="4" Orientation="Vertical">
            <CheckBox x:Name="EnableDalamudCheckBox"
                      Content="啟用 Dalamud"
                      Style="{StaticResource MaterialDesignCheckBox}"
                      Margin="0,0,0,12"/>

            <!-- Dalamud Source Mode -->
            <StackPanel IsEnabled="{Binding IsChecked, ElementName=EnableDalamudCheckBox}">
                <TextBlock Text="Dalamud 來源"
                           Style="{StaticResource MaterialDesignBody2TextBlock}"
                           FontWeight="Medium"
                           Margin="0,0,0,8"/>

                <!-- Auto Download Option -->
                <RadioButton x:Name="AutoDownloadRadio"
                             GroupName="DalamudSource"
                             IsChecked="True"
                             Margin="0,0,0,4">
                    <StackPanel Orientation="Vertical">
                        <TextBlock Text="自動下載 (推薦)"
                                   FontWeight="Medium"/>
                        <TextBlock Text="自動從 yanmucorp/Dalamud 下載最新版本"
                                   FontSize="11"
                                   Foreground="Gray"/>
                    </StackPanel>
                </RadioButton>

                <!-- Local Path Option -->
                <RadioButton x:Name="LocalPathRadio"
                             GroupName="DalamudSource"
                             Margin="0,8,0,4">
                    <StackPanel Orientation="Vertical">
                        <TextBlock Text="手動指定路徑"
                                   FontWeight="Medium"/>
                        <TextBlock Text="使用本地已編譯的 Dalamud"
                                   FontSize="11"
                                   Foreground="Gray"/>
                    </StackPanel>
                </RadioButton>

                <!-- Local Path Selection (only visible when LocalPathRadio is checked) -->
                <Grid Margin="24,8,0,0"
                      Visibility="{Binding IsChecked, ElementName=LocalPathRadio, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0"
                             x:Name="LocalDalamudPathTextBox"
                             materialDesign:HintAssist.Hint="Dalamud 資料夾路徑"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             IsReadOnly="True"
                             Margin="0,0,8,0"/>

                    <Button Grid.Column="1"
                            Content="瀏覽"
                            Click="BrowseLocalDalamud_Click"
                            Style="{StaticResource MaterialDesignOutlinedButton}"/>
                </Grid>

                <!-- Injection Delay -->
                <Grid Margin="0,16,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="注入延遲 (毫秒)："
                               VerticalAlignment="Center"
                               Margin="0,0,8,0"/>

                    <TextBox Grid.Column="1"
                             x:Name="InjectionDelayTextBox"
                             Text="0"
                             materialDesign:HintAssist.Hint="延遲"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             PreviewTextInput="InjectionDelayTextBox_PreviewTextInput"/>
                </Grid>

                <!-- Info text -->
                <TextBlock Text="Dalamud 和 .NET Runtime 會在登入時自動下載/更新"
                           FontSize="11"
                           Foreground="Gray"
                           Margin="0,12,0,0"
                           Visibility="{Binding IsChecked, ElementName=AutoDownloadRadio, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                <!-- Clean up environment variable -->
                <StackPanel Margin="0,12,0,0">
                    <Button x:Name="CleanEnvVarButton"
                            Content="清除 Dalamud Runtime 環境變數"
                            Click="CleanEnvVarButton_Click"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            HorizontalAlignment="Left"/>
                    <TextBlock Text="如果同時使用簡中版 Dalamud (ottercorp)，清除此變數可恢復簡中版正常運作"
                               FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Margin="0,4,0,0"/>
                </StackPanel>
            </StackPanel>
        </StackPanel>

        <!-- Buttons -->
        <StackPanel Grid.Row="6" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
            <Button x:Name="SaveButton"
                    Content="儲存"
                    Click="SaveButton_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    MinWidth="100"
                    Padding="16,8"
                    Margin="0,0,8,0"/>

            <Button x:Name="CancelButton"
                    Content="取消"
                    Click="CancelButton_Click"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    MinWidth="80"
                    Padding="16,8"/>
        </StackPanel>
    </Grid>
</Window>
