<Window x:Class="FFXIVSimpleLauncher.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="設定"
        Height="680" Width="520"
        MinHeight="500" MinWidth="400"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        Background="{DynamicResource MaterialDesignPaper}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        FontFamily="{materialDesign:MaterialDesignFont}">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0"
                   Text="設定"
                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                   Margin="0,0,0,16"/>

        <!-- Game Path -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBox Grid.Column="0"
                     x:Name="GamePathTextBox"
                     materialDesign:HintAssist.Hint="遊戲路徑"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     Margin="0,0,8,0"/>

            <Button Grid.Column="1"
                    Content="瀏覽"
                    Click="BrowseButton_Click"
                    Style="{StaticResource MaterialDesignOutlinedButton}"/>
        </Grid>

        <!-- OTP Section -->
        <TextBlock Grid.Row="2"
                   Text="自動 OTP (一次性密碼)"
                   Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                   Margin="0,24,0,8"/>

        <StackPanel Grid.Row="3" Orientation="Vertical">
            <CheckBox x:Name="AutoOtpCheckBox"
                      Content="啟用自動 OTP"
                      Style="{StaticResource MaterialDesignCheckBox}"
                      Margin="0,0,0,8"/>

            <TextBlock Text="啟用後登入時會自動填入 OTP 驗證碼"
                       FontSize="11"
                       Foreground="Gray"
                       Margin="0,0,0,12"/>

            <!-- OTP Secret Input -->
            <Grid IsEnabled="{Binding IsChecked, ElementName=AutoOtpCheckBox}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0"
                         x:Name="OtpSecretTextBox"
                         materialDesign:HintAssist.Hint="OTP 密鑰 (Base32)"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                         Margin="0,0,8,0"/>

                <Button Grid.Column="1"
                        x:Name="SaveOtpButton"
                        Content="儲存密鑰"
                        Click="SaveOtpSecret_Click"
                        Style="{StaticResource MaterialDesignOutlinedButton}"/>
            </Grid>

            <!-- Current OTP Display -->
            <StackPanel Orientation="Horizontal"
                        Margin="0,12,0,0"
                        Visibility="{Binding IsChecked, ElementName=AutoOtpCheckBox, Converter={StaticResource BooleanToVisibilityConverter}}">
                <TextBlock Text="目前 OTP："
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <TextBlock x:Name="CurrentOtpText"
                           Text="------"
                           FontFamily="Consolas"
                           FontSize="18"
                           FontWeight="Bold"
                           Foreground="{DynamicResource PrimaryHueMidBrush}"
                           VerticalAlignment="Center"/>
                <TextBlock x:Name="OtpCountdownText"
                           Text="(--s)"
                           FontSize="12"
                           Foreground="Gray"
                           VerticalAlignment="Center"
                           Margin="8,0,0,0"/>
                <Button x:Name="ClearOtpButton"
                        Content="清除密鑰"
                        Click="ClearOtpSecret_Click"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        Foreground="OrangeRed"
                        Margin="16,0,0,0"/>
            </StackPanel>

            <TextBlock Text="密鑰可從 SE 帳號設定的 OTP 頁面取得 (顯示為 QR Code 下方的文字)"
                       FontSize="11"
                       Foreground="Gray"
                       TextWrapping="Wrap"
                       Margin="0,8,0,0"/>
        </StackPanel>

        <!-- Dalamud Section -->
        <TextBlock Grid.Row="4"
                   Text="Dalamud (插件系統)"
                   Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                   Margin="0,24,0,8"/>

        <StackPanel Grid.Row="5" Orientation="Vertical">
            <CheckBox x:Name="EnableDalamudCheckBox"
                      Content="啟用 Dalamud"
                      Style="{StaticResource MaterialDesignCheckBox}"
                      Margin="0,0,0,12"/>

            <!-- Dalamud Source Mode -->
            <StackPanel IsEnabled="{Binding IsChecked, ElementName=EnableDalamudCheckBox}">
                <TextBlock Text="Dalamud 來源"
                           Style="{StaticResource MaterialDesignBody2TextBlock}"
                           FontWeight="Medium"
                           Margin="0,0,0,8"/>

                <!-- Auto Download Option -->
                <RadioButton x:Name="AutoDownloadRadio"
                             GroupName="DalamudSource"
                             IsChecked="True"
                             Margin="0,0,0,4">
                    <StackPanel Orientation="Vertical">
                        <TextBlock Text="自動下載 (推薦)"
                                   FontWeight="Medium"/>
                        <TextBlock Text="自動從 yanmucorp/Dalamud 下載最新版本"
                                   FontSize="11"
                                   Foreground="Gray"/>
                    </StackPanel>
                </RadioButton>

                <!-- Local Path Option -->
                <RadioButton x:Name="LocalPathRadio"
                             GroupName="DalamudSource"
                             Margin="0,8,0,4">
                    <StackPanel Orientation="Vertical">
                        <TextBlock Text="手動指定路徑"
                                   FontWeight="Medium"/>
                        <TextBlock Text="使用本地已編譯的 Dalamud"
                                   FontSize="11"
                                   Foreground="Gray"/>
                    </StackPanel>
                </RadioButton>

                <!-- Local Path Selection (only visible when LocalPathRadio is checked) -->
                <Grid Margin="24,8,0,0"
                      Visibility="{Binding IsChecked, ElementName=LocalPathRadio, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0"
                             x:Name="LocalDalamudPathTextBox"
                             materialDesign:HintAssist.Hint="Dalamud 資料夾路徑"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             IsReadOnly="True"
                             Margin="0,0,8,0"/>

                    <Button Grid.Column="1"
                            Content="瀏覽"
                            Click="BrowseLocalDalamud_Click"
                            Style="{StaticResource MaterialDesignOutlinedButton}"/>
                </Grid>

                <!-- Injection Delay -->
                <Grid Margin="0,16,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="注入延遲 (毫秒)："
                               VerticalAlignment="Center"
                               Margin="0,0,8,0"/>

                    <TextBox Grid.Column="1"
                             x:Name="InjectionDelayTextBox"
                             Text="0"
                             materialDesign:HintAssist.Hint="延遲"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             PreviewTextInput="InjectionDelayTextBox_PreviewTextInput"/>
                </Grid>

                <!-- Info text -->
                <TextBlock Text="Dalamud 和 .NET Runtime 會在登入時自動下載/更新"
                           FontSize="11"
                           Foreground="Gray"
                           Margin="0,12,0,0"
                           Visibility="{Binding IsChecked, ElementName=AutoDownloadRadio, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </StackPanel>
        </StackPanel>

        <!-- Buttons -->
        <StackPanel Grid.Row="7" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="儲存"
                    Click="SaveButton_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Width="80"
                    Margin="0,0,8,0"/>

            <Button Content="取消"
                    Click="CancelButton_Click"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Width="80"/>
        </StackPanel>
    </Grid>
</Window>
